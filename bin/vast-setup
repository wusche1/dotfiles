#!/bin/zsh

if [ -z "$1" ]; then
    echo "Usage: vast-setup <repo-url>"
    exit 1
fi

REPO_URL=$1
REPO_NAME=$(basename "$REPO_URL" .git)
WORKSPACE="$HOME/workspace"

# Setup dotfiles
echo "Setting up dotfiles..."
ln -sf ~/dotfiles/.zshrc ~/.zshrc
source ~/.zshrc

# Persist environment variables
env >> /etc/environment

# Install uv if not present
if ! command -v uv &> /dev/null; then
    echo "Installing uv..."
    curl -LsSf https://astral.sh/uv/install.sh | sh
    source $HOME/.cargo/env
fi

mkdir -p "$WORKSPACE"
cd "$WORKSPACE"

echo "Cloning $REPO_URL..."
git clone "$REPO_URL"

echo "Setting up $REPO_NAME..."
cd "$REPO_NAME"

echo "Running uv sync..."
uv sync

# Install Cursor extensions
install-cursor-extensions

echo "Setup complete! You're now in $WORKSPACE/$REPO_NAME"

